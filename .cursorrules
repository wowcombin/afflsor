# CURSOR RULES - ERP Afflsor Project

–¢—ã AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ ERP —Å–∏—Å—Ç–µ–º—ã Afflsor. –°–ª–µ–¥—É–π —ç—Ç–∏–º –ø—Ä–∞–≤–∏–ª–∞–º –°–¢–†–û–ì–û.

## üéØ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–û–í–ï–†–ö–ò –ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú –†–ê–ë–û–¢–´

1. **–í–°–ï–ì–î–ê —á–∏—Ç–∞–π —Ñ–∞–π–ª—ã vision/ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º:**
   - vision/.1 –¥–æ vision/.7 - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ
   - vision/CODEX_CURSOR.md - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

2. **–ò–∑—É—á–∏ —Å–∏—Å—Ç–µ–º—É —Ä–æ–ª–µ–π:**
   - junior: —Å–æ–∑–¥–∞–µ—Ç —Ä–∞–±–æ—Ç—ã, –≤—ã–≤–æ–¥—ã
   - manager: —É–ø—Ä–∞–≤–ª—è–µ—Ç Junior, –æ–¥–æ–±—Ä—è–µ—Ç –≤—ã–≤–æ–¥—ã
   - tester: —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –∫–∞–∑–∏–Ω–æ
   - hr: —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏  
   - cfo: —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
   - admin: –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø

3. **–ü—Ä–æ–≤–µ—Ä—å —Å—Ö–µ–º—É –ë–î –≤ supabase/migrations/**

## üîê RLS –ü–û–õ–ò–¢–ò–ö–ò - –ö–†–ò–¢–ò–ß–ù–û

**–ü–†–ê–í–ò–õ–û #1: –í–°–ï —Ç–∞–±–ª–∏—Ü—ã –î–û–õ–ñ–ù–´ –∏–º–µ—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏**

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–∏–∑–º–µ–Ω–µ–Ω–∏–∏ RLS –ø–æ–ª–∏—Ç–∏–∫:
- ‚úÖ –í–°–ï–ì–î–ê –≤–∫–ª—é—á–∞–π –í–°–ï –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–æ–ª–∏ (manager, admin, hr)
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–π –¥–æ—Å—Ç—É–ø –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ
- ‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ —Å–æ–∑–¥–∞–≤–∞–π –ø–æ–ª–∏—Ç–∏–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è —á–∞—Å—Ç–∏ —Ä–æ–ª–µ–π

–®–∞–±–ª–æ–Ω RLS –ø–æ–ª–∏—Ç–∏–∫–∏:
```sql
CREATE POLICY "policy_name" ON table_name
FOR SELECT USING (
    auth.uid() IN (
        SELECT auth_id FROM users 
        WHERE role IN ('manager', 'admin', 'hr') 
        AND status = 'active'
    )
);
```

## üîÑ API –†–ê–ó–†–ê–ë–û–¢–ö–ê

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ API:**
```typescript
export async function GET/POST(request: NextRequest) {
  try {
    // 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    const supabase = await createClient()
    const { data: { user }, error } = await supabase.auth.getUser()
    if (!user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })

    // 2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    console.log('API called:', { endpoint, user: user.email })

    // 3. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
    
    return NextResponse.json(result)
  } catch (error) {
    console.error('API Error:', error)
    return NextResponse.json({ 
      error: 'Internal server error',
      details: error.message 
    }, { status: 500 })
  }
}
```

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–†–ò –ü–†–û–ë–õ–ï–ú–ê–•

–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –¥–æ—Å—Ç—É–ø–∞/–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–≤–∞–π:
1. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É** `/debug-auth` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ user data
2. **–¢–µ—Å—Ç–æ–≤—ã–π API** `/test-api` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ endpoints
3. **–ü—Ä–æ—Å—Ç–æ–π API** –±–µ–∑ JOIN –¥–ª—è –ø–æ—à–∞–≥–æ–≤–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## üí∞ –ë–ò–ó–ù–ï–°-–õ–û–ì–ò–ö–ê

**–†–∞—Å—á–µ—Ç –ø—Ä–æ—Ñ–∏—Ç–∞:**
```typescript
const convertToUSD = (amount: number, currency: string): number => {
  const rates = {
    'USD': 1,
    'GBP': 1.27 * 0.95, // Google rate -5%
    'EUR': 1.09 * 0.95,
    'CAD': 0.74 * 0.95
  }
  return amount * (rates[currency] || 1)
}

// –ü—Ä–æ—Ñ–∏—Ç = –í—ã–≤–æ–¥ - –î–µ–ø–æ–∑–∏—Ç (–≤ USD)
const profit = convertToUSD(withdrawal, currency) - convertToUSD(deposit, currency)
```

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ó–ê–ü–†–ï–¢–´

**–ù–ò–ö–û–ì–î–ê –ù–ï –î–ï–õ–ê–ô:**
1. RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑ —Ä–æ–ª–∏ manager/admin
2. API –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
3. –°–ª–æ–∂–Ω—ã–µ JOIN –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
4. –°—Ç–∞—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)
5. –ö–æ–º–º–∏—Ç—ã —Å –æ—à–∏–±–∫–∞–º–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

## ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø

**–í–°–ï–ì–î–ê –î–ï–õ–ê–ô:**
1. `npm run build` –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
2. –°–æ–∑–¥–∞–≤–∞–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
3. –¢–µ—Å—Ç–∏—Ä—É–π –∫–∞–∂–¥—É—é —Ä–æ–ª—å –æ—Ç–¥–µ–ª—å–Ω–æ
4. –î–æ–±–∞–≤–ª—è–π –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤ API
5. –û–±—ä—è—Å–Ω—è–π –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã, –∞ –Ω–µ —Å–∏–º–ø—Ç–æ–º—ã

## üìã –ß–ï–ö-–õ–ò–°–¢ –ü–ï–†–ï–î –ö–û–ú–ú–ò–¢–û–ú

- [ ] `npm run build` —É—Å–ø–µ—à–Ω–æ
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ä–æ–ª–∏  
- [ ] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤–∫–ª—é—á–∞—é—Ç –≤—Å–µ –Ω—É–∂–Ω—ã–µ —Ä–æ–ª–∏
- [ ] API –∏–º–µ–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–´

1. **üî• –ö—Ä–∏—Ç–∏—á–Ω–æ:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, RLS, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
2. **‚ö° –í–∞–∂–Ω–æ:** –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å  
3. **üé® –ú–æ–∂–Ω–æ –ø–æ—Ç–æ–º:** UI/UX —É–ª—É—á—à–µ–Ω–∏—è

## üí¨ –ö–û–ú–ú–£–ù–ò–ö–ê–¶–ò–Ø –° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ú

**–û–±—ä—è—Å–Ω—è–π:**
- –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã ("RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ –≤–∫–ª—é—á–∞—é—Ç —Ä–æ–ª—å manager")
- –ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Å–ª–æ–º–∞–Ω–æ ("middleware –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ")
- –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

**–ù–ï –≥–æ–≤–æ—Ä–∏:**
- "–î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å" –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
- "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑" –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
- "–ü—Ä–æ–±–ª–µ–º–∞ –≤ API" –±–µ–∑ —É—Ç–æ—á–Ω–µ–Ω–∏—è –∫–∞–∫–∞—è –∏–º–µ–Ω–Ω–æ

---

**–ü–û–ú–ù–ò: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!**
